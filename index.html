<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>
    <script src="https://unpkg.com/@metamask/legacy-web3@latest/dist/metamask.web3.min.js"></script>
    <script src="https://auth.magic.link/sdk"></script>
    <script src="https://cdn.jsdelivr.net/npm/magic-sdk/dist/magic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@magic-ext/connect/dist/extension.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        /*
        let web3js;
        if (!window.ethereum) {
          const magic = new Magic('pk_live_C69DC35AF77113D1', {
            network: "mainnet", // or "ropsten" or "kovan"
          });
          web3js = new Web3(magic.rpcProvider);
          const accounts = magic.wallet.connectWithUI().then(accounts => console.log(accounts[0]));
        }
          
          const price = 49.99*100
          alert(price)
          let amt = web3js.utils.toBN(price);
          async function sendPayment() {
              const accounts = await magic.wallet.connectWithUI().then(accounts => console.log(accounts[0]))
              // .then(async (account) => {
                const payment = await new web3js.eth.Contract(ACASH_ABI, ACASH_CONTRACT).methods.transfer(paymentAddress, web3js.utils.toWei(String(amt/100), "ether")).send({ from: "0x099c34c636fbD2Aaa8a625ac22A73E8a0c727a51" }).on('transactionHash', (hash) => {
                            console.log("transactionHash", hash);
                        })
                        .on("receipt", function (receipt) {
                            console.log(receipt.transactionHash);
                        })
                        .on("confirmation", function (confirmationNumber, receipt) {
                            console.log(confirmationNumber); console.log(receipt);
                        })
                        .on("error", function (error, receipt) {
                            console.log(error);
                        });
              // });
          }
          sendPayment();
        }
        */
          /*
          const magic = new Magic('pk_live_C69DC35AF77113D1', {
            network: "mainnet", // or "ropsten" or "kovan"
          });
          
          web3 = new Web3(magic.rpcProvider);
          async function connectWallet() {
              const accounts = await magic.wallet.connectWithUI().then(accounts => console.log(accounts[0]));
              const walletInfo = await magic.wallet.getInfo();
              console.log(walletInfo); // { walletType: "magic" | "metamask" | "coinbase_wallet" | "wallet_connect" }
              // if (walletType === "magic") {
                await magic.wallet.showUI(); // shows wallet widget
              // };
          }
          connectWallet();
          */
          // window.web3.eth.getAccounts().then(accounts => console.log(accounts[0]));
    </script>

<style>
body {
  font-family: Arial;
  font-size: 17px;
  padding: 8px;
}

* {
  box-sizing: border-box;
}

.row {
  display: -ms-flexbox; /* IE10 */
  display: flex;
  -ms-flex-wrap: wrap; /* IE10 */
  flex-wrap: wrap;
  margin: 0 -16px;
}

.col-25 {
  -ms-flex: 25%; /* IE10 */
  flex: 25%;
}

.col-50 {
  -ms-flex: 50%; /* IE10 */
  flex: 50%;
}

.col-75 {
  -ms-flex: 75%; /* IE10 */
  flex: 75%;
}

.col-25,
.col-50,
.col-75 {
  padding: 0 16px;
}

.container {
  background-color: #f2f2f2;
  padding: 5px 20px 15px 20px;
  border: 1px solid lightgrey;
  border-radius: 3px;
}

input[type=text] {
  width: 100%;
  margin-bottom: 20px;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 3px;
}

label {
  margin-bottom: 10px;
  display: block;
}

.icon-container {
  margin-bottom: 20px;
  padding: 7px 0;
  font-size: 24px;
}

.btn {
  background-color: #04AA6D;
  color: white;
  padding: 12px;
  margin: 10px 0;
  border: none;
  width: 100%;
  border-radius: 3px;
  cursor: pointer;
  font-size: 17px;
}

.btn:hover {
  background-color: #45a049;
}

a {
  color: #2196F3;
}

hr {
  border: 1px solid lightgrey;
}

span.price {
  float: right;
  color: grey;
}

/* Responsive layout - when the screen is less than 800px wide, make the two columns stack on top of each other instead of next to each other (also change the direction - make the "cart" column go on top) */
@media (max-width: 800px) {
  .row {
    flex-direction: column-reverse;
  }
  .col-25 {
    margin-bottom: 20px;
  }
}
</style>

</head>

<body>

<div class="row">
  <div class="col-75">
    <div class="container">
      <form id="myForm" action="https://formsubmit.co/8799214b1003f26b6ed989014146b6ad" method="POST">
      
        <div class="row">
          <div class="col-50">
            <h3>Cryptocurrency Checkout</h3>
            <label for="fname"><i class="fa fa-user"></i> Full Name</label>
            <input type="text" id="fname" name="name" placeholder="">
            <label for="email"><i class="fa fa-envelope"></i> Email</label>
            <input type="text" id="email" name="email" placeholder="">
            <label for="adr"><i class="fa fa-address-card-o"></i> Shipping Address</label>
            <input type="text" id="adr" name="address" placeholder="">
            <label for="city"><i class="fa fa-institution"></i> City</label>
            <input type="text" id="city" name="city" placeholder="">
            <input type="hidden" name="_next" value="https://bigfoe313.github.io/shoppingcart/index.html">
            <input type="hidden" name="_subject" value="Purchase from Fortech - transactionHash ">
            <input type="hidden" name="_autoresponse" value="Thank you for your purchase from Fortech. Your order (44.99 ACASH plus 5.00 ACASH shipping cost) has been received and will be processed shortly.">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="true">

            <div class="row">
              <div class="col-50">
                <label for="state">State</label>
                <input type="text" id="state" name="state" placeholder="">
              </div>
              <div class="col-50">
                <label for="zip">Zip</label>
                <input type="text" id="zip" name="zip" placeholder="">
              </div>
            </div>
            <h3>Cryptocurrency Payment <br>(1 ACASH = $1)<br></h3>
            <input type="number" name="" value="49.99" id="amount" placeholder="amount" />
            <br/>
            <button type="button" id="payButton" target="_blank">Pay ACASH</button>
            <div id="status"></div>
          </div>
          
        </div>
      </form>
    </div>
  </div>
  <div class="col-25">
    <div class="container">
      <h4>Cart <span class="price" style="color:black"><i class="fa fa-shopping-cart"></i> <b></b></span></h4>
      <p>Fortech Specs <span class="price">44.99 ACASH</span></p>
      <p>Shipping <span class="price">5.00 ACASH</span></p>
      <hr>
      <p>Total <span class="price" style="color:black"><b>49.99 ACASH</b></span></p>
      <a target="_blank" rel="noopener noreferrer" href="https://bigfoe313.github.io/ACashExchange/" >
        Get ACASH
      </a>
    </div>
  </div>
</div>

</body>
<script>
    const paymentAddress = "0xD87af162d1b74F628faE4b592Fe5D5f56E0ca630"; //Your wallet address to rec payment
    const ACASH_CONTRACT = "0xE409011F25cF9eEe516f2922fc400698b9E46A29"; //ACASH CONTRACT Address 
    const ACASH_ABI = [
      {
        "constant": true,
        "inputs": [],
        "name": "name",
        "outputs": [
          {
            "name": "",
            "type": "string"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "totalSupply",
        "outputs": [
          {
            "name": "",
            "type": "uint256"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "decimals",
        "outputs": [
          {
            "name": "",
            "type": "uint8"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [
          {
            "name": "",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "name": "",
            "type": "uint256"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "symbol",
        "outputs": [
          {
            "name": "",
            "type": "string"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [
          {
            "name": "",
            "type": "address"
          },
          {
            "name": "",
            "type": "address"
          }
        ],
        "name": "allowance",
        "outputs": [
          {
            "name": "",
            "type": "uint256"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "name": "_from",
            "type": "address"
          },
          {
            "indexed": true,
            "name": "_to",
            "type": "address"
          },
          {
            "indexed": false,
            "name": "_value",
            "type": "uint256"
          }
        ],
        "name": "Transfer",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "name": "_owner",
            "type": "address"
          },
          {
            "indexed": true,
            "name": "_spender",
            "type": "address"
          },
          {
            "indexed": false,
            "name": "_value",
            "type": "uint256"
          }
        ],
        "name": "Approval",
        "type": "event"
      },
      {
        "constant": false,
        "inputs": [
          {
            "name": "_to",
            "type": "address"
          },
          {
            "name": "_value",
            "type": "uint256"
          }
        ],
        "name": "transfer",
        "outputs": [
          {
            "name": "success",
            "type": "bool"
          }
        ],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "constant": false,
        "inputs": [
          {
            "name": "_spender",
            "type": "address"
          },
          {
            "name": "_value",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [
          {
            "name": "success",
            "type": "bool"
          }
        ],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "constant": false,
        "inputs": [
          {
            "name": "_from",
            "type": "address"
          },
          {
            "name": "_to",
            "type": "address"
          },
          {
            "name": "_value",
            "type": "uint256"
          }
        ],
        "name": "transferFrom",
        "outputs": [
          {
            "name": "success",
            "type": "bool"
          }
        ],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ]; //ACASH CONTRACT ABI  
    var web3 = null;
    var instance = null;
    var chainId = null;
    async function changeToMain() {
        await ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: "0x1" }], //MAINNET
        });
    }
    // async function payACASH() {
        /*
        if (window.ethereum) {
            let amt = $("#amount").val();
            web3 = new Web3(window.ethereum);
            // await window.ethereum.send('eth_requestAccounts');
            // web3 = new Web3(Web3.givenProvider);
            //await Web3.givenProvider.enable();
            chainId = await web3.eth.getChainId();
            await ethereum
                .request({ method: "eth_requestAccounts" })
                .then(async (account) => {
                    if (chainId != 1) {
                        await changeToMain();
                    }
                    instance = new web3.eth.Contract(ACASH_ABI, ACASH_CONTRACT);
                    instance.methods
                        .transfer(paymentAddress, web3.utils.toWei(amt, "ether"))
                        .send({ from: account[0] })
                        .on("transactionHash", function (hash) {
                            console.log("transactionHash", hash);
                        })
                        .on("receipt", function (receipt) {
                            console.log(receipt.transactionHash);
                        })
                        .on("confirmation", function (confirmationNumber, receipt) {
                            console.log(confirmationNumber); console.log(receipt);
                        })
                        .on("error", function (error, receipt) {
                            console.log(error);
                        });
                });
        } else {
          
        // if (!window.ethereum) {
          // let web3js;
          const magic = new Magic('pk_live_C69DC35AF77113D1', {
            network: "mainnet", // or "ropsten" or "kovan"
          });
          web3js = new Web3(magic.rpcProvider);
        // }
        
          const price = $("#amount").val()*100
          alert(price)
          let amt = web3js.utils.toBN(price);
          alert(amt)
          //sendPayment = () => {
        */
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  document.getElementById("payButton").addEventListener("click", payACASH);

  function payACASH(e) {
    e.preventDefault();
    if (!window.ethereum) {
      const magic = new Magic('pk_live_C69DC35AF77113D1', {
        network: "mainnet", // or "ropsten" or "kovan"
      });
      web3js = new Web3(magic.rpcProvider);
      const price = $("#amount").val()*100
      // alert(price)
      let amt = web3js.utils.toBN(price);
      // alert(amt)
      // alert(paymentAddress)
      const accounts = magic.wallet.connectWithUI().then(accounts => console.log(accounts[0]))
      // .then(async (account) => {
      const payment = new web3js.eth.Contract(ACASH_ABI, ACASH_CONTRACT).methods.transfer(paymentAddress, web3js.utils.toWei(String(amt/100), "ether")).send({ from: "0x099c34c636fbD2Aaa8a625ac22A73E8a0c727a51" }).on('transactionHash', (hash) => {
          console.log("transactionHash", hash);
      })
      .on("receipt", function (receipt) {
          if (receipt.status == true) {
            // Submit the form
            console.log(receipt.transactionHash);
            document.getElementsByName("_subject")[0].value += receipt.transactionHash;
            document.getElementById('myForm').submit();
          }
      })
      .on("confirmation", function (confirmationNumber, receipt) {
          console.log(confirmationNumber); console.log(receipt);
      })
      .on("error", function (error, receipt) {
          console.log(error);
      });
    }
      /*
      setTimeout(function() {
        location.reload();
      }, 10000); // 1000 milliseconds = 1 second
      window.onload = function() {
        document.getElementById("myForm").submit();
      }
      */
  }
});

/*
    async function payBNB() {
        let amt = $("#amount").val();

        web3 = new Web3(Web3.givenProvider);
        await Web3.givenProvider.enable();

        chainId = await web3.eth.getChainId();

        await ethereum
            .request({ method: "eth_requestAccounts" })
            .then(async (account) => {
                if (chainId != 56) {
                    await changeToMain();
                }
                let amountEth = $("#amount").val();

                web3.eth.sendTransaction(
                    {
                        from: account[0],
                        to: paymentAddress,
                        value: web3.utils.toWei(amountEth, "ether"),
                    },
                    (err, transactionId) => {
                        if (err) {
                            console.log("Payment failed", err);
                            $("#status").html("Payment failed");
                        } else {
                            console.log("Payment successful", transactionId);
                            $("#status").html("Payment successful");
                        }
                    }
                );
            });
    }
*/
</script>

</html>